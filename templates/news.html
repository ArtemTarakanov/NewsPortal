{% extends 'flatpages/default.html' %}
{% load news_filters %}
{% load news_tags %}

{% block title %}
–ù–æ–≤–æ—Å—Ç–∏
{% endblock title %}

{% block content %}
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1>–í—Å–µ –Ω–æ–≤–æ—Å—Ç–∏</h1>
        <a href="{% url 'news_create' %}" class="btn btn-success">+ –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤–æ—Å—Ç—å</a>
    </div>
    
    <form action="" method="get" class="mb-4">
        {{ filterset.form.as_p }}
        <input type="submit" value="–ù–∞–π—Ç–∏" class="btn btn-primary" />
    </form>
    
    <h3>{% current_time '%d.%m.%Y %H:%M' %}</h3>
    <p class="text-muted">{% news_stats %}</p>
    
    <hr>

    {% if news %}  
        {% for item in news %}  
            <div class="card mb-4">
                <div class="card-body">
                    <h5 class="card-title">{{ item.title|censor }}</h5>  
                    <p class="text-muted">
                        {{ item.date_creation|date:'d.m.Y' }} | 
                        –ê–≤—Ç–æ—Ä: {{ item.author.user.username }} | 
                        –†–µ–π—Ç–∏–Ω–≥: 
                        <span class="{{ item.rating|rating_color }}">
                            <strong>{{ item.rating }}</strong>
                        </span>
                        |
                        {{ item.rating|rating_label:'text' }}
                        {{ item.rating|rating_label:'icon' }}
                    </p>
                    
                    {# ‚Üì‚Üì‚Üì –ö–ù–û–ü–ö–ò –ü–û–î–ü–ò–°–ö–ò –ù–ê –ö–ê–¢–ï–ì–û–†–ò–ò ‚Üì‚Üì‚Üì #}
                    {% if user.is_authenticated %}
                        <div class="mb-3">
                            <small class="text-muted">–ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏:</small>
                            {% for category in item.categories.all %}
                                {% if user in category.subscribers.all %}
                                    <a href="{% url 'unsubscribe' category.id %}" class="btn btn-outline-secondary btn-sm">–û—Ç–ø–∏—Å–∞—Ç—å—Å—è –æ—Ç {{ category.name }}</a>
                                {% else %}
                                    <a href="{% url 'subscribe' category.id %}" class="btn btn-primary btn-sm">–ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ {{ category.name }}</a>
                                {% endif %}
                            {% endfor %}
                        </div>
                    {% endif %}
                    
                    <p class="card-text">{{ item.text|censor|truncatechars:20 }}</p>
                    
                    {# ‚Üì‚Üì‚Üì –ö–ù–û–ü–ö–ò –†–ï–î–ê–ö–¢–ò–†–û–í–ê–ù–ò–Ø –ò –£–î–ê–õ–ï–ù–ò–Ø ‚Üì‚Üì‚Üì #}
                    <div class="mt-3">
                        <a href="{% url 'news_edit' item.pk %}" class="btn btn-warning btn-sm">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</a>
                        <a href="{% url 'news_delete' item.pk %}" class="btn btn-danger btn-sm">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</a>
                    </div>
                </div>
            </div>
        {% endfor %}
        
        {% if is_paginated %}
            <nav aria-label="Page navigation">
                <ul class="pagination justify-content-center">
                    {% if page_obj.has_previous %}
                        <li class="page-item">
                            <a class="page-link" href="?{% url_replace page=1 %}">–ü–µ—Ä–≤–∞—è</a>
                        </li>
                        <li class="page-item">
                            <a class="page-link" href="?{% url_replace page=page_obj.previous_page_number %}">‚Üê –ù–∞–∑–∞–¥</a>
                        </li>
                    {% endif %}

                    <li class="page-item disabled">
                        <span class="page-link">
                            –°—Ç—Ä–∞–Ω–∏—Ü–∞ {{ page_obj.number }} –∏–∑ {{ page_obj.paginator.num_pages }}
                        </span>
                    </li>

                    {% if page_obj.has_next %}
                        <li class="page-item">
                            <a class="page-link" href="?{% url_replace page=page_obj.next_page_number %}">–í–ø–µ—Ä–µ–¥ ‚Üí</a>
                        </li>
                        <li class="page-item">
                            <a class="page-link" href="?{% url_replace page=page_obj.paginator.num_pages %}">–ü–æ—Å–ª–µ–¥–Ω—è—è</a>
                        </li>
                    {% endif %}
                </ul>
            </nav>
        {% endif %}
        
    {% else %}  
        <h2>–ù–æ–≤–æ—Å—Ç–µ–π –Ω–µ—Ç!</h2>
    {% endif %}
{% endblock content %}